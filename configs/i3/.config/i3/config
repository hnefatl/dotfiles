set $alt Mod1
set $sup Mod4
set $caps Mod3

# Handle suspend after timeout
{%- if WORK %}
exec --no-startup-id xss-lock --transfer-sleep-lock -- /usr/share/goobuntu-desktop-files/xsecurelock.sh
exec --no-startup-id env LOCKED_BY_SESSION_IDLE=true xautolock -time 10 -locker /usr/share/goobuntu-desktop-files/xsecurelock.sh
{%- else %}
exec --no-startup-id xidlehook --not-when-fullscreen --not-when-audio --timer 1800 'systemctl suspend' ''
{%- endif %}

# Font for window titles. Will also be used by the bar unless a different font
# is used in the bar {} block below.
font pango:Noto Sans Mono 10

# Use Mouse+$mod to drag floating windows to their wanted position
floating_modifier $caps

bindsym $caps+t exec --no-startup-id {% if "terminator" in PATH_BINARIES %}terminator{% else %}xterm{% endif %}
bindsym $caps+w exec --no-startup-id {% if "firefox" in PATH_BINARIES %}firefox{% else %}chrome{% endif %}

# kill focused window
bindsym $sup+q kill

# start dmenu
bindsym $sup+d exec --no-startup-id dmenu_run

# change focus
bindsym $sup+j focus down
bindsym $sup+k focus up
# rotating left/right cycles within the current workspace, to avoid overflowing to adjacent outputs
# vertical movement does move between outputs because I normally have my laptop below my monitors.
# https://github.com/dustbyte/i3-cycle
#bindsym $sup+h exec i3-cycle left
#bindsym $sup+l exec i3-cycle right
bindsym $sup+h focus left
bindsym $sup+l focus right

# move focused window
bindsym $sup+Shift+h move left
bindsym $sup+Shift+j move down
bindsym $sup+Shift+k move up
bindsym $sup+Shift+l move right

# split in horizontal orientation
bindsym $sup+g split h

# split in vertical orientation
bindsym $sup+t split v

# enter fullscreen mode for the focused container
bindsym $sup+f fullscreen toggle

# change container layout (stacked, tabbed, toggle split)
bindsym $sup+s layout stacking
bindsym $sup+w layout tabbed
bindsym $sup+e layout toggle split

# toggle tiling / floating
bindsym $sup+space floating toggle

# change focus between tiling / floating windows
bindsym $sup+b focus mode_toggle

# switch to workspace
bindsym $sup+1 workspace number 1
bindsym $sup+2 workspace number 2
bindsym $sup+3 workspace number 3
bindsym $sup+4 workspace number 4
bindsym $sup+5 workspace number 5
bindsym $sup+6 workspace number 6
bindsym $sup+7 workspace number 7
bindsym $sup+8 workspace number 8
bindsym $sup+9 workspace number 9
bindsym $sup+0 workspace number 10
bindsym $sup+grave workspace {% if WORK %}meetings{% else %}main{% endif %}
bindsym $sup+minus workspace vert

bindsym $sup+m workspace next
bindsym $sup+n workspace prev

bindsym $sup+$alt+Shift+l move workspace to output right
bindsym $sup+$alt+Shift+h move workspace to output left
bindsym $sup+$alt+Shift+j move workspace to output down
bindsym $sup+$alt+Shift+k move workspace to output up

# move focused container to workspace
bindsym $sup+Shift+1 move container to workspace number 1; workspace number 1
bindsym $sup+Shift+2 move container to workspace number 2; workspace number 2
bindsym $sup+Shift+3 move container to workspace number 3; workspace number 3
bindsym $sup+Shift+4 move container to workspace number 4; workspace number 4
bindsym $sup+Shift+5 move container to workspace number 5; workspace number 5
bindsym $sup+Shift+6 move container to workspace number 6; workspace number 6
bindsym $sup+Shift+7 move container to workspace number 7; workspace number 7
bindsym $sup+Shift+8 move container to workspace number 8; workspace number 8
bindsym $sup+Shift+9 move container to workspace number 9; workspace number 9
bindsym $sup+Shift+0 move container to workspace number 10; workspace number 10
bindsym $sup+Shift+grave move container to workspace meetings; workspace meetings
bindsym $sup+Shift+minus move container to workspace vert; workspace vert

bindsym $sup+Shift+m move container to workspace next; workspace next
bindsym $sup+Shift+n move container to workspace prev; workspace prev

# reload the configuration file
bindsym $sup+r reload
bindsym $sup+Shift+r restart
# restart i3 inplace (preserves your layout/session, can be used to upgrade i3)
# Alternative is i3-msg restart, preferred
#bindsym $sup+r restart
# exit i3 (logs you out of your X session)
bindsym $sup+Shift+q exec "i3-nagbar -t warning -m 'You pressed the exit shortcut. Do you really want to exit i3? This will end your X session.' -b 'Yes, exit i3' 'i3-msg exit'"

# resize window (you can also use the mouse for that)
#mode "resize" {
#        # These bindings trigger as soon as you enter the resize mode
#
#        # Pressing left will shrink the window’s width.
#        # Pressing right will grow the window’s width.
#        # Pressing up will shrink the window’s height.
#        # Pressing down will grow the window’s height.
#        bindsym h resize shrink width 10 px or 10 ppt
#        bindsym j resize grow height 10 px or 10 ppt
#        bindsym k resize shrink height 10 px or 10 ppt
#        bindsym l resize grow width 10 px or 10 ppt
#
#        # back to normal: Enter or Escape
#        bindsym Return mode "default"
#        bindsym Escape mode "default"
#}
#bindsym $sup+Shift+r mode "resize"

bindsym $sup+u resize grow width 5px or 5ppt
bindsym $sup+Shift+u resize shrink width 5px or 5ppt
bindsym $sup+i resize grow height 5px or 5ppt
bindsym $sup+Shift+i resize shrink height 5px or 5ppt


bar {
    output eDP-1
    output DP-2-8
    output DP-3
    output DP-3-8
    tray_output eDP-1

    font pango:Noto Sans Mono 11
    status_command i3blocks
    position top

    colors {
    	inactive_workspace #555555 #222222 #888888
	    urgent_workspace   #2f343a #900000 #ffffff
    }
}
bar {
    output DP-2-1-8
    output DP-3-1-8
    tray_output none
    font pango:Noto Sans Mono 11
    position top

    colors {
    	inactive_workspace #555555 #222222 #888888
	    urgent_workspace   #2f343a #900000 #ffffff
    }
}

new_window pixel 2
focus_follows_mouse no
hide_edge_borders smart

# Shutdown, restart, sleep commands
# Power-related commands disabled for now, virtually never need to run them on workstation
#bindsym $sup+$caps+p exec --no-startup-id systemctl poweroff
#bindsym $sup+$caps+r exec --no-startup-id systemctl reboot
#bindsym $sup+$caps+h exec --no-startup-id systemctl suspend
bindsym $sup+$caps+q exit

# Audio controls
bindsym XF86AudioRaiseVolume exec --no-startup-id "pactl set-sink-volume @DEFAULT_SINK@ +5% ; pkill -RTMIN+10 i3blocks"
bindsym XF86AudioLowerVolume exec --no-startup-id "pactl set-sink-volume @DEFAULT_SINK@ -5% ; pkill -RTMIN+10 i3blocks"
bindsym Shift+XF86AudioRaiseVolume exec --no-startup-id "pactl set-sink-volume @DEFAULT_SINK@ +1% ; pkill -RTMIN+10 i3blocks"
bindsym Shift+XF86AudioLowerVolume exec --no-startup-id "pactl set-sink-volume @DEFAULT_SINK@ -1% ; pkill -RTMIN+10 i3blocks"
bindsym XF86AudioMute exec --no-startup-id "amixer set Master toggle ; pkill -RTMIN+10 i3blocks"

# Sreen brightness controls
bindsym XF86MonBrightnessUp exec --no-startup-id "brightnessctl set +5% ; pkill -RTMIN+12 i3blocks"
bindsym XF86MonBrightnessDown exec --no-startup-id "brightnessctl set 5%- ; pkill -RTMIN+12 i3blocks"
bindsym Shift+XF86MonBrightnessUp exec --no-startup-id "brightnessctl set +1% ; pkill -RTMIN+12 i3blocks"
bindsym Shift+XF86MonBrightnessDown exec --no-startup-id "brightnessctl set 1%- ; pkill -RTMIN+12 i3blocks"

# Audio commands
{%- if PC %}
{#- PC keyboard has a play/pause physical button which always sends a play keypress #}
bindsym XF86AudioPlay exec --no-startup-id "playerctl -p spotify play-pause ; pkill -RTMIN+11 i3blocks"
{%- else %}
bindsym XF86AudioPlay exec --no-startup-id "playerctl -p spotify play ; pkill -RTMIN+11 i3blocks"
bindsym XF86AudioPause exec --no-startup-id "playerctl -p spotify pause ; pkill -RTMIN+11 i3blocks"
{%- endif %}
bindsym XF86AudioNext exec --no-startup-id "playerctl -p spotify next ; sleep 0.1 ; pkill -RTMIN+11 i3blocks"
bindsym XF86AudioPrev exec --no-startup-id "playerctl -p spotify previous ; sleep 0.1 ; pkill -RTMIN+11 i3blocks"
bindsym $sup+p exec --no-startup-id "playerctl -p spotify play-pause ; pkill -RTMIN+11 i3blocks"
bindsym $sup+bracketleft exec --no-startup-id "pactl set-sink-volume @DEFAULT_SINK@ -5% ; pkill -RTMIN+10 i3blocks"
bindsym $sup+bracketright exec --no-startup-id "pactl set-sink-volume @DEFAULT_SINK@ +5% ; pkill -RTMIN+10 i3blocks"
bindsym $sup+Shift+braceleft exec --no-startup-id "pactl set-sink-volume @DEFAULT_SINK@ -1% ; pkill -RTMIN+10 i3blocks"
bindsym $sup+Shift+braceright exec --no-startup-id "pactl set-sink-volume @DEFAULT_SINK@ +1% ; pkill -RTMIN+10 i3blocks"
bindsym $sup+apostrophe exec --no-startup-id "playerctl -p spotify previous ; sleep 0.1 ; pkill -RTMIN+11 i3blocks"
bindsym $sup+numbersign exec --no-startup-id "playerctl -p spotify next ; sleep 0.1 ; pkill -RTMIN+11 i3blocks"
bindsym $sup+slash exec --no-startup-id ~/bin/dmenu-audio

# Lock screen
bindsym $sup+$caps+l exec --no-startup-id /usr/share/goobuntu-desktop-files/xsecurelock.sh

# Rename workspace:
#bindsym $sup+Return exec --no-startup-id i3-msg -q rename workspace to "$(dmenu-input 'New workspace: ')"
bindsym $sup+Return exec --no-startup-id i3-input -F 'rename workspace to "%s"' -P 'Name:'
bindsym $sup+Shift+Return exec --no-startup-id swap_workspaces

# printscreen
{%- if WORK %}
bindsym Print exec --no-startup-id gnome-screenshot -i
{%- else %}
# interactive to clipboard
bindsym Print exec --no-startup-id         scrot      -s -f -o $(mktemp /tmp/screenshot_XXX.png) -Z 0 -e 'xclip -selection clipboard -t image/png -i $f'
# whole screen to clipboard
bindsym Shift+Print exec --no-startup-id   scrot         -f -o $(mktemp /tmp/screenshot_XXX.png) -Z 0 -e 'xclip -selection clipboard -t image/png -i $f'
# delay a few seconds
bindsym Control+Print exec --no-startup-id scrot -d 3 -s -f -o $(mktemp /tmp/screenshot_XXX.png) -Z 0 -e 'xclip -selection clipboard -t image/png -i $f'
# TODO: look at flameshot or slurp instead
{%- endif %}

# dmenu emoji script
bindsym $sup+a exec --no-startup-id ~/bin/dmenu-emoji

# dunst
#bindsym $mod+x exec --no-startup-id dunstctl close
#bindsym $mod+Shift+x exec --no-startup-id dunstctl close-all

# Focus the parent
bindsym $sup+semicolon focus parent
bindsym $sup+Shift+semicolon focus child

# Border colours
# Colour Class          Border          Background      Text            Indicator           Child Border
#client.focused          0000FF         #
